<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Compute.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Compute.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { observable, isObservable } from "./Observable.js";

export { observable, isObservable };

// The following is supposed to work but it doesn't work either in VSCode or in JSDoc. Fun.

/**
 * Unpack all the observables and return an array of values
 * @param {...Observable} observables 
 * @returns {any[]}
 * @private
 */
export const gather = (...observables) => observables.map(obs => obs());

/**
 * @callback MultiObserver
 * @param {any[]} values
 * @description This callback will be called with the current values of all the observables.
 * @example
 * const obs1 = observable(1);
 * const obs2 = observable(2);
 * const obs3 = observable(3);
 * const fn = (a, b, c) => console.log(`${a}-${b}-${c}`); // This is the MultiObserver
 * onChange(fn, obs1, obs2, obs3);
 * obs1(2);  // logs 2-2-3
 * obs2(3);  // logs 2-3-3
 * obs3(4);  // logs 2-3-4
 */

/**
 * Call the supplied function when any of the observables change. The function will be called with the current values of the observables.
 * @param {MultiObserver} fn 
 * @param  {...import("./typedefs.js").Observable} observables 
 * @returns {import("./typedefs.js").Subscription}
 * 
 * @example
 * const obs1 = observable(1);
 * const obs2 = observable(2);
 * const obs3 = observable(3);
 * onChange((a, b, c) => console.log(a + b + c), obs1, obs2, obs3);
 * obs1(2);  // logs 7
 * obs2(3);  // logs 8
 * obs3(4);  // logs 9
 */
export function onChange (fn, ...observables) {
  const handleChange = () => fn(...gather(...observables));
  const subscriptions = observables.map(obs => obs.subscribe(handleChange));

  return {
    unsubscribe: () => subscriptions.forEach(subscription => subscription.unsubscribe()),
  };
};

/**
 * @interface SubscribedObservable
 * @extends {import("./typedefs.js").Observable}
 * @extends {import("./typedefs.js").Subscription}
 */

/**
 * @typedef {Function} ObservableValueCalculator
 * @param {any[]} observableValues
 * @returns {*}
 */

/**
 * @memberof Compute
 * @param {ObservableValueCalculator} fn 
 * @param  {...import("./typedefs.js").Observable} observables 
 * @returns {SubscribedObservable}
 */
export function from(fn, ...observables) {
  const o = observable(fn(...gather(...observables)));
  const handleChange = (...newValues) => {
    console.log("[from] handleChange called", newValues, "=>", fn(...newValues));
    return o(fn(...newValues));
  };
  const { unsubscribe } = onChange(handleChange, ...observables);
  o.unsubscribe = unsubscribe;
  return o;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SubscriptionManager.html">SubscriptionManager</a></li></ul><h3>Interfaces</h3><ul><li><a href="Observable.html">Observable</a></li><li><a href="SubscribedObservable.html">SubscribedObservable</a></li><li><a href="Subscription.html">Subscription</a></li></ul><h3>Global</h3><ul><li><a href="global.html#isObservable">isObservable</a></li><li><a href="global.html#observable">observable</a></li><li><a href="global.html#onChange">onChange</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Tue May 28 2024 03:49:44 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
